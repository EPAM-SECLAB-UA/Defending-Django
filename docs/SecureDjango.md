
# –ü–∏—Ç–∞–Ω–Ω—è:

1. –ß–æ–º—É –Ω–µ –≤–∞—Ä—Ç–æ –≤–∏—Å—Ç–∞–≤–ª—è—Ç–∏ Django –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç?

# –ß–æ–º—É –Ω–µ –º–æ–∂–Ω–∞ –≤–∏—Å—Ç–∞–≤–ª—è—Ç–∏ Django –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç

## 1. **`runserver` –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è production**

Django `runserver` ‚Äî —Ü–µ **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–æ–∑—Ä–æ–±–∫–∏**, –Ω–µ production-—Å–µ—Ä–≤–µ—Ä:

```bash
python manage.py runserver  # ‚ùå –¢—ñ–ª—å–∫–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏!
```

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚ö†Ô∏è **–û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∏–π** ‚Äî –æ–±—Ä–æ–±–ª—è—î –ª–∏—à–µ –æ–¥–∏–Ω –∑–∞–ø–∏—Ç –æ–¥–Ω–æ—á–∞—Å–Ω–æ
- ‚ö†Ô∏è **–ë–µ–∑ –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ DoS** ‚Äî –ª–µ–≥–∫–æ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
- ‚ö†Ô∏è **–ü–æ–≤—ñ–ª—å–Ω–∏–π** ‚Äî –Ω–µ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- ‚ö†Ô∏è **–ù–µ–±–µ–∑–ø–µ—á–Ω–∏–π** ‚Äî –Ω–µ –º–∞—î –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –∞—Ç–∞–∫

## 2. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å HTTPS-—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó**

Django —Å–∞–º –Ω–µ –æ–±—Ä–æ–±–ª—è—î SSL/TLS –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ:
- üîí Nginx –æ–±—Ä–æ–±–ª—è—î HTTPS —à–≤–∏–¥—à–µ —Ç–∞ –±–µ–∑–ø–µ—á–Ω—ñ—à–µ
- üîí –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞–º–∏
- üîí –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ Let's Encrypt + Certbot

## 3. **–°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ –æ–±—Å–ª—É–≥–æ–≤—É—é—Ç—å—Å—è –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**

Django **–Ω–µ –ø–æ–≤–∏–Ω–µ–Ω** —Ä–æ–∑–¥–∞–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏–∫—É –≤ production:

```python
# ‚ùå –¶–µ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏:
STATIC_URL = '/static/'

# ‚úÖ –í production —Å—Ç–∞—Ç–∏–∫—É —Ä–æ–∑–¥–∞—î Nginx:
location /static/ {
    alias /var/www/django/static/;
    expires 30d;
}
```

**–ß–æ–º—É Nginx –∫—Ä–∞—â–µ:**
- ‚ö° –£ **10-100 —Ä–∞–∑—ñ–≤ —à–≤–∏–¥—à–µ** –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
- üíæ –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –∫–µ—à—É–≤–∞–Ω–Ω—è
- üóúÔ∏è Gzip/Brotli —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è "–∑ –∫–æ—Ä–æ–±–∫–∏"

## 4. **–í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–æ—Ä—Ç–∏ = –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å**

–í–∏—Å—Ç–∞–≤–ª–µ–Ω–Ω—è Django –Ω–∞ `:8000`:
```
http://yoursite.com:8000/admin/  # ‚ùå –í–∏–¥–Ω–æ –ø–æ—Ä—Ç!
```

**–ü—Ä–æ–±–ª–µ–º–∏:**
- üëÅÔ∏è –†–æ–∑–∫—Ä–∏–≤–∞—î –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º–∏
- üéØ –ü–æ–ª–µ–≥—à—É—î —Ü—ñ–ª–µ—Å–ø—Ä—è–º–æ–≤–∞–Ω—ñ –∞—Ç–∞–∫–∏
- üö´ –ü–æ—Ä—É—à—É—î –ø—Ä–∏–Ω—Ü–∏–ø "defense in depth"

**–ó Nginx:**
```
https://yoursite.com/admin/  # ‚úÖ –ß–∏—Å—Ç–∏–π URL, –ø–æ—Ä—Ç –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π
```

## 5. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –±–∞–ª–∞–Ω—Å—É–≤–∞–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**

–ë–µ–∑ Nginx –Ω–µ–º–æ–∂–ª–∏–≤–æ:
- üîÑ –ó–∞–ø—É—Å–∫–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ Django (Gunicorn workers)
- üìä –†–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- üîß –†–æ–±–∏—Ç–∏ zero-downtime deployments

## 6. **–í—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥–æ –∞—Ç–∞–∫**

**Django –±–µ–∑ Nginx –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –¥–ª—è:**

### Rate Limiting
```nginx
# Nginx –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ DDoS
limit_req_zone $binary_remote_addr zone=django:10m rate=10r/s;
```

### Header Injection
```nginx
# Nginx –æ—á–∏—â—É—î —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header X-Real-IP $remote_addr;
```

### Slowloris –∞—Ç–∞–∫–∏
- Nginx –æ–±—Ä–æ–±–ª—è—î –ø–æ–≤—ñ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
- Django `runserver` –ª–µ–≥–∫–æ –±–ª–æ–∫—É—î—Ç—å—Å—è

## 7. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –º–µ–¥—ñ–∞-—Ñ–∞–π–ª—ñ–≤**

```python
# ‚ùå Django –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω —Ä–æ–∑–¥–∞–≤–∞—Ç–∏ –≤–µ–ª–∏–∫—ñ —Ñ–∞–π–ª–∏
MEDIA_URL = '/media/'

# ‚úÖ Nginx –∑ X-Accel-Redirect (internal redirect)
location /media/ {
    internal;
    alias /var/www/django/media/;
}
```

## 8. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É**

Nginx –Ω–∞–¥–∞—î:
- üìù –î–µ—Ç–∞–ª—å–Ω—ñ access logs
- üö® Error logs –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- üîç –õ–µ–≥–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Prometheus/Grafana

## –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç
   ‚Üì
[Nginx :80, :443]  ‚Üê HTTPS-—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—è, —Å—Ç–∞—Ç–∏–∫–∞, –∫–µ—à—É–≤–∞–Ω–Ω—è
   ‚Üì
[Gunicorn :8000]   ‚Üê WSGI-—Å–µ—Ä–≤–µ—Ä (–∫—ñ–ª—å–∫–∞ workers)
   ‚Üì
[Django App]       ‚Üê –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
   ‚Üì
[PostgreSQL]       ‚Üê –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
```

## Production-ready –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

**1. Gunicorn –∑–∞–º—ñ—Å—Ç—å runserver:**
```bash
gunicorn myproject.wsgi:application \
    --bind 127.0.0.1:8000 \
    --workers 4 \
    --timeout 60
```

**2. Nginx —è–∫ reverse proxy:**
```nginx
location / {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_set_header X-Real-IP $remote_addr;
}
```

**3. Systemd –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É:**
```ini
[Service]
ExecStart=/path/to/venv/bin/gunicorn myproject.wsgi
Restart=always
```

## –í–∏—Å–Ω–æ–≤–æ–∫

**Django –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç = –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞:**
- üêå –ü–æ–≤—ñ–ª—å–Ω–æ
- üîì –ù–µ–±–µ–∑–ø–µ—á–Ω–æ  
- üí• –ù–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ
- üìâ –ù–µ–º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ

**–ó Nginx:**
- ‚ö° –®–≤–∏–¥–∫–æ
- üîí –ë–µ–∑–ø–µ—á–Ω–æ
- üí™ –°—Ç–∞–±—ñ–ª—å–Ω–æ
- üìà –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ

**–ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:** Nginx –∑–∞–≤–∂–¥–∏ –º–∞—î –±—É—Ç–∏ –ø–µ—Ä—à–∏–º —Ä—ñ–≤–Ω–µ–º –æ–±–æ—Ä–æ–Ω–∏ —É –≤–∞—à—ñ–π production —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ñ!


-----------------------------------------------------------------------------------------------------------


# –†–µ–∑—é–º–µ: Nginx —è–∫ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –ø—Ä–æ–∫—Å—ñ –¥–ª—è Django + Hugo
https://medium.com/@anzaloquin/nginx-for-django-hugo-reverse-proxy-like-a-pro-2c4f7f5cb378

## –ß–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω Nginx?

**–ù–µ –≤–∞—Ä—Ç–æ –≤–∏—Å—Ç–∞–≤–ª—è—Ç–∏ Django –∞–±–æ Hugo –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç, —Ç–æ–º—É —â–æ:**
- `runserver` Django –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –ª–∏—à–µ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ ‚Äî –±–µ–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –±–µ–∑–ø–µ–∫–∏
- `hugo server` —Ç–∞–∫–æ–∂ –Ω–µ –¥–ª—è production ‚Äî –¥–∏–Ω–∞–º—ñ—á–Ω–æ –ø–µ—Ä–µ–±—É–¥–æ–≤—É—î—Ç—å—Å—è —Ç–∞ –Ω–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π
- –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–æ—Ä—Ç–∏ (`:8000`, `:1313`) –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ —Ç–∞ –Ω–µ–∑—Ä—É—á–Ω—ñ
- HTTPS-—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—é, –¥–æ—Å—Ç–∞–≤–∫—É —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—é –∫—Ä–∞—â–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ Nginx

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Nginx

**–§–∞–π–ª:** `/etc/nginx/sites-available/sgbh`

```nginx
# HTTP ‚Üí HTTPS —Ä–µ–¥—ñ—Ä–µ–∫—Ç
server {
    listen 80;
    server_name sgbh.org www.sgbh.org;
    return 301 https://$host$request_uri;
}

# HTTPS —Å–µ—Ä–≤–µ—Ä
server {
    listen 443 ssl;
    server_name sgbh.org www.sgbh.org;
    
    # SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏
    ssl_certificate     /etc/letsencrypt/live/sgbh.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/sgbh.org/privkey.pem;
    
    # Django admin (–ø—Ä–æ–∫—Å—ñ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç)
    location /admin/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # Hugo —Å—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏
    location / {
        root /var/www/hugo;
        index index.html;
        try_files $uri $uri/ =404;
    }
}
```

## –ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

- **`listen 80`**: –ø—Ä–∏–π–º–∞—î HTTP —Ç–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ HTTPS —á–µ—Ä–µ–∑ `301`
- **`listen 443 ssl`**: –ø—Ä–∏–π–º–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π HTTPS —Ç—Ä–∞—Ñ—ñ–∫
- **`ssl_certificate*`**: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ Let's Encrypt –≤—ñ–¥ Certbot
- **`/admin/`**: –≤–µ—Å—å —Ç—Ä–∞—Ñ—ñ–∫ Django admin –ø—Ä–æ–∫—Å—ñ—é—î—Ç—å—Å—è –Ω–∞ `localhost:8000`
- **`/`**: —Ä–µ—à—Ç–∞ —Ç—Ä–∞—Ñ—ñ–∫—É –æ–±—Å–ª—É–≥–æ–≤—É—î—Ç—å—Å—è —è–∫ —Å—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ Hugo –∑ `/var/www/hugo`

## –ü—Ä–æ SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ (.pem)

**PEM = Privacy Enhanced Mail** ‚Äî –∫–æ–¥—É–≤–∞–Ω–Ω—è base64 –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏:
- **`fullchain.pem`**: –≤–∞—à —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç + –ø—Ä–æ–º—ñ–∂–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏
- **`privkey.pem`**: –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á (–∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –≤ –±–µ–∑–ø–µ—Ü—ñ üîí)

## –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å

**–ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó**
```bash
sudo nginx -t
```

**–ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**
```bash
sudo systemctl reload nginx
```

**–ö—Ä–æ–∫ 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**
```bash
curl -I https://sgbh.org/
curl -I https://sgbh.org/admin/
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
HTTP/2 200
server: nginx
```

## DNS –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ DNS –∑–∞–ø–∏—Å–∏ (A –∞–±–æ CNAME) –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ –ø—É–±–ª—ñ—á–Ω—É IP-–∞–¥—Ä–µ—Å—É –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ë–µ–∑ —Ü—å–æ–≥–æ Nginx –Ω–∞–≤—ñ—Ç—å –Ω–µ –∑–º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏.

## –û—Å–Ω–æ–≤–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏

‚úÖ Nginx —Ä–æ–∑—É–º–Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑—É—î —Ç—Ä–∞—Ñ—ñ–∫ –¥–æ Django (`/admin/`) —Ç–∞ Hugo (`/`)  
‚úÖ –û–±—Ä–æ–±–ª—è—î SSL-—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—é —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫—É —Å—Ç–∞—Ç–∏–∫–∏  
‚úÖ –ü—Ä–∏—Ö–æ–≤—É—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –ø–æ—Ä—Ç–∏  
‚úÖ –ó–∞–±–µ–∑–ø–µ—á—É—î –±–µ–∑–ø–µ–∫—É —Ç–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å  

**–ì–æ–ª–æ–≤–Ω–µ –ø—Ä–∞–≤–∏–ª–æ:** –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —á–µ—Ä–µ–∑ `nginx -t` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º!






# –ë–µ–∑–ø–µ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Django –∑–∞ –∑–≤–æ—Ä–æ—Ç–Ω–∏–º –ø—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä–æ–º
https://medium.com/@anas-issath/stop-trusting-your-reverse-proxy-secure-django-the-right-way-ec45bad71c34

## –û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞

Django –Ω–µ –±–∞—á–∏—Ç—å –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ HTTPS-–∑'—î–¥–Ω–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ —ñ –ø–æ–∫–ª–∞–¥–∞—î—Ç—å—Å—è –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤—ñ–¥ –ø—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `X-Forwarded-Proto`), —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —á–∏ –∑–∞–ø–∏—Ç –±–µ–∑–ø–µ—á–Ω–∏–π. –Ø–∫—â–æ —Ü—ñ —Å–∏–≥–Ω–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∞–±–æ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω—ñ, Django –º–æ–∂–Ω–∞ –æ–±–¥—É—Ä–∏—Ç–∏.

## –¢–∏–ø–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏

**1. –ü—ñ–¥—Ä–æ–±–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤**
- –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –ø—ñ–¥—Ä–æ–±–∏—Ç–∏ `X-Forwarded-Proto: https`
- Django –≤–≤–∞–∂–∞—Ç–∏–º–µ –∑–∞–ø–∏—Ç –±–µ–∑–ø–µ—á–Ω–∏–º —ñ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookies –∑ –ø—Ä–∞–ø–æ—Ä–æ–º `Secure` —á–µ—Ä–µ–∑ –∑–≤–∏—á–∞–π–Ω–∏–π HTTP
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤–∏—Ç—ñ–∫ session cookies

**2. –ü–æ–º–∏–ª–∫–∏ CSRF**
- –ü—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä–∏ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–ø–∏—Å—É—é—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Host` —Ç–∞ `Origin`
- Django –≤—ñ–¥—Ö–∏–ª—è—î –ª–µ–≥—ñ—Ç–∏–º–Ω—ñ CSRF-–∑–∞–ø–∏—Ç–∏
- –ü—Ä–æ–±–ª–µ–º–∞ –≤–∏—è–≤–ª—è—î—Ç—å—Å—è –ª–∏—à–µ –≤ production –ø—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–∞ ALB, Cloudflare –∞–±–æ Nginx

**3. –ë–µ–∑–∫—ñ–Ω–µ—á–Ω—ñ —Ä–µ–¥—ñ—Ä–µ–∫—Ç–∏**
- –ü—Ä–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ–º—É `SECURE_SSL_REDIRECT = True` Django –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ HTTP-–∑–∞–ø–∏—Ç–∏ –Ω–∞ HTTPS
- –Ø–∫—â–æ Django –Ω–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –∑–∞–ø–∏—Ç —è–∫ –±–µ–∑–ø–µ—á–Ω–∏–π, –≤–∏–Ω–∏–∫–∞—î —Ü–∏–∫–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç—ñ–≤

## –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

**1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä–∞**
```nginx
proxy_set_header Host              $host;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header X-Real-IP         $remote_addr;
proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
```

**2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Django**
```python
# –í–∫–∞–∑–∞—Ç–∏ Django, —è–∫–æ–º—É –∑–∞–≥–æ–ª–æ–≤–∫—É –¥–æ–≤—ñ—Ä—è—Ç–∏
SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')

# –ü—Ä–∏–º—É—Å–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HTTPS
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_HSTS_SECONDS = 31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS = True

# –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ–º–µ–Ω—ñ–≤
ALLOWED_HOSTS = ["yourapp.com", "www.yourapp.com"]
CSRF_TRUSTED_ORIGINS = ["https://yourapp.com"]
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –º–µ—Ç–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏

- **PROXY Protocol**: –Ω–∞–¥—ñ–π–Ω—ñ—à–∏–π —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–¥–∞—á—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–ª—ñ—î–Ω—Ç–∞
- **Mutual TLS**: –≤–∑–∞—î–º–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º—ñ–∂ –ø—Ä–æ–∫—Å—ñ —Ç–∞ Django
- **–ü—Ä–∏–≤–∞—Ç–Ω—ñ –º–µ—Ä–µ–∂—ñ (VPC)**: —ñ–∑–æ–ª—è—Ü—ñ—è —Ç—Ä–∞—Ñ—ñ–∫—É
- **TLS Passthrough**: Django —Å–∞–º –æ–±—Ä–æ–±–ª—è—î TLS

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫ Django –≤–∏–∑–Ω–∞—á–∞—î —Å—Ö–µ–º—É –∑–∞–ø–∏—Ç—É
2. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—ñ–¥—Ä–æ–±–∏—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–ø–æ—Ä–∏ secure —É cookies
4. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å HSTS
5. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ CSRF origins
6. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É —Ä–µ–¥–∏—Ä–µ–∫—Ç—ñ–≤

## –ì–æ–ª–æ–≤–Ω–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫

**–ù—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–≤—ñ—Ä—è–π—Ç–µ –ø—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä—É —Å–ª—ñ–ø–æ.** –°—Ç–≤–æ—Ä—ñ—Ç—å —á—ñ—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–æ–≤—ñ—Ä–∏ –º—ñ–∂ –ø—Ä–æ–∫—Å—ñ —Ç–∞ Django, –ø—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –π–æ–≥–æ —Ç–∞ –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å. –ü—Ä–æ–∫—Å—ñ –º–∞—î –≤–∏–¥–∞–ª—è—Ç–∏ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ –Ω–∞–¥—ñ–π–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è, –∞ Django –ø–æ–≤–∏–Ω–µ–Ω –¥–æ–≤—ñ—Ä—è—Ç–∏ –ª–∏—à–µ —è–≤–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.
